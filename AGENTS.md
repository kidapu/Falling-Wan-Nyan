# Repository Guidelines

## プロジェクト構成とモジュール配置
本リポジトリは TypeScript + Phaser 3 + Vite で構築された落下アクションゲームです。起動処理は `src/main.ts` に集約され、ゲーム進行は `src/scenes` 内の `GameScene` と `BaseGameScene` が担います。共通ロジック（生成・音声・物理・凸包計算など）は `src/managers`、テキスト処理は `src/utils` に置かれます。実行時アセットは `data/`（`audio/`、`illust/`、`json/`、`texture/`）にまとめ、ビルド成果物は `dist/`。レガシービルド用のスクリプトはリポジトリ直下（`build.js`、`server.js`）にあります。

## ビルド・テスト・開発コマンド
依存関係同期は初回に `npm install` を実行します。ローカル開発は `npm run dev` が Vite のホットリロードサーバーを起動します。`npm run build` は厳格な型チェック後に最適化バンドルを `dist/` に出力します。`npm run preview` でビルド済みアセットをローカル確認可能です。GitHub Pages 用の静的配信は `npm run build-legacy` で最小化し、`npm run serve-legacy` でレガシーサーバーを起動して挙動を確認します。

## コーディングスタイルと命名規則
TypeScript は strict 設定です。`any` や暗黙の型抑制は避け、警告を残さないようにしてください。インデントは 4 スペースを基本とし、クラスは PascalCase（`AudioPermissionManager`）、関数・変数は camelCase を用います。Phaser 固有の数値は意味のある定数にまとめ、`tsconfig.json` で定義された `@/*` エイリアスか相対パスでインポートしてください。変更前に `npm run build` を通して型エラーがないことを確認します。

## テスト指針
自動テストは未整備のため、手動検証が前提です。`npm run preview` でデスクトップ表示を確認後、モバイル端末またはエミュレーターでリサイズ・スプラッシュ画面・音声許可・スポーン挙動・ルビ表示をチェックしてください。アセットを追加した際はキャッシュクリアやサーバー再起動で読み込みを再確認し、修正バグの再現手順と確認結果を PR に記載します。

## コミットとプルリクエスト指針
コミットメッセージは既存履歴にならい、短く要点を押さえた日本語の説明（例: `背景画像のレイアウトを変更`）を推奨します。変更範囲は極力小さくまとめ、PR では変更概要・目的・関連 Issue・UI/オーディオ変更のスクリーンショットや動画、実施した手動テスト（デスクトップ/モバイル、音声 ON/OFF など）を記述してください。レビューが必要な設定変更や手順があれば備考に明記します。

## デプロイメモ
GitHub Pages では相対パスが前提です。`npm run build-legacy` 実行後、`dist/` とレガシー出力の両方で `data/` 配下のアセットが正しく参照されるかを再確認し、公開前に最新版へ更新してください。
